<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>CRUD testing</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/bulma-css/bulma/css/bulma.min.css">
  </head>
  <body>
    <!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    <section class="section">
      <div class="container">
        <h1 class="title">CRUD Testing</h1>
        <p class="subtitle">Testing all API operations for the <strong>SW Saga</strong> API!</p>
        <form>
          <div class="columns">
            <div class="column">
              <div class="field">
                <label class="label">Character Name</label>
                <div class="control">
                  <input class="input" type="text" placeholder="Obi-wan Kenobi" id="character-name" name="character-name" required>
                </div>
                <p class="help">Please use a fairly decent in universe name</p>
              </div>
            </div>
            <div class="column">
              <div class="field">
                <label class="label">Player Name</label>
                <div class="control">
                  <input class="input" type="text" placeholder="John Doe" id="player-name" name="player-name" required>
                </div>
                <p class="help">Definitely user your name</p>
              </div>
            </div>
          </div>  
          <div class="columns">
            <div class="column">
              <div class="field">
                <label class="label">Age</label>
                <p class="control">
                  <input class="input" type="text" placeholder="0-99" id="age" name="age" required>
                </p>
              </div>
            </div>
            <div class="column">
              <div class="field">
                <label class="label">Gender</label>
                <p class="control">
                  <input class="input" type="text" placeholder="M/F/Other" id="gender" name="gender" required>
                </p>
              </div>
            </div>
            <div class="column">
              <div class="field">
                <label class="label">Height</label>
                <p class="control">
                  <input class="input" type="text" placeholder="6'0" id="height" name="height" required>
                </p>
              </div>
            </div>
            <div class="column">
              <div class="field">
                <label class="label">Weight</label>
                <p class="control">
                  <input class="input" type="text" placeholder="97 kg" id="weight" name="weight" required>
                </p>
              </div>
            </div>
          </div>
          <div class="columns">
            <div class="column">
              <div class="field has-addons">
                <p class="control">
                  <a class="button is-static">
                    STR
                  </a>
                </p>
                <p class="control">
                  <input class="input" type="text" placeholder="STRength" id="str" name="str" required>
                </p>
              </div>
              <p class="help">Enter a number 0-20</p>
            </div>
            <div class="column">
              <div class="field has-addons">
                <p class="control">
                  <a class="button is-static">
                    DEX
                  </a>
                </p>
                <p class="control">
                  <input class="input" type="text" placeholder="DEXterity" id="dex" name="dex" required>
                </p>
              </div>
              <p class="help">Enter a number 0-20</p>
            </div>
            <div class="column">
              <div class="field has-addons">
                <p class="control">
                  <a class="button is-static">
                    CON
                  </a>
                </p>
                <p class="control">
                  <input class="input" type="text" placeholder="CONstitution" id="con" name="con" required>
                </p>
              </div>
              <p class="help">Enter a number 0-20</p>
            </div>
            <div class="column">
              <div class="field has-addons">
                <p class="control">
                  <a class="button is-static">
                    INT
                  </a>
                </p>
                <p class="control">
                  <input class="input" type="text" placeholder="INTelligence" id="int" name="int" required>
                </p>
              </div>
              <p class="help">Enter a number 0-20</p>
            </div>
            <div class="column">
              <div class="field has-addons">
                <p class="control">
                  <a class="button is-static">
                    WIS
                  </a>
                </p>
                <p class="control">
                  <input class="input" type="text" placeholder="WISdom" id="wis" name="wis" required>
                </p>
              </div>
              <p class="help">Enter a number 0-20</p>
            </div>
            <div class="column">
              <div class="field has-addons">
                <p class="control">
                  <a class="button is-static">
                    CHA
                  </a>
                </p>
                <p class="control">
                  <input class="input" type="text" placeholder="CHArisma" id="cha" name="cha" required>
                </p>
              </div>
              <p class="help">Enter a number 0-20</p>
            </div>
          </div>
          <div class="columns">
            <div class="column">
              <div class="field has-addons">
                <p class="control">
                  <a class="button is-static">
                    HP
                  </a>
                </p>
                <p class="control">
                  <input class="input" type="text" placeholder="40" id="hitPoints" name="hitPoints" required>
                </p>
              </div>
              <p class="help">Health Points</p>
            </div>
            <div class="column">
              <div class="field has-addons">
                <p class="control">
                  <a class="button is-static">
                    FP
                  </a>
                </p>
                <p class="control">
                  <input class="input" type="text" placeholder="5" id="forcePoints" name="forcePoints" required>
                </p>
              </div>
              <p class="help">Force points</p>
            </div>
            <div class="column">
              <div class="field has-addons">
                <p class="control">
                  <a class="button is-static">
                    BAB
                  </a>
                </p>
                <p class="control">
                  <input class="input" type="text" placeholder="1" id="baseAttackBonus" name="baseAttackBonus" required>
                </p>
              </div>
              <p class="help">Base Attack Bonus</p>
            </div>
            <div class="column">
              <div class="field has-addons">
                <p class="control">
                  <a class="button is-static">
                    DR
                  </a>
                </p>
                <p class="control">
                  <input class="input" type="text" placeholder="0" id="damageReduction" name="damageReduction" required>
                </p>
              </div>
              <p class="help">Damage Reduction</p>
            </div>
            <div class="column">
              <div class="field has-addons">
                <p class="control">
                  <a class="button is-static">
                    SR
                  </a>
                </p>
                <p class="control">
                  <input class="input" type="text" placeholder="0" id="shieldReduction" name="shieldReduction" required>
                </p>
              </div>
              <p class="help">Shield Reduction</p>
            </div>
          </div> 
          <div class="columns">
            <div class="column">
              <div class="field">
                <label class="label">Reflex Defense</label>
                <p class="control">
                  <input class="input" type="text" placeholder="1" id="refDef" name="refDef" required>
                </p>
              </div>
            </div>
            <div class="column">
              <div class="field">
                <label class="label">Fortitude Defense</label>
                <p class="control">
                  <input class="input" type="text" placeholder="2" id="fortDef" name="fortDef" required>
                </p>
              </div>
            </div>
            <div class="column">
              <div class="field">
                <label class="label">Will Defense</label>
                <p class="control">
                  <input class="input" type="text" placeholder="1" id="wilDef" name="wilDef" required>
                </p>
              </div>
            </div>
            <div class="column">
              <div class="field">
                <label class="label">Condition</label>
                <p class="control">
                  <input class="input" type="text" placeholder="0-5" id="condition" name="condition" required>
                </p>
              </div>
            </div>
          </div> 
          <div class="columns">
            <div class="column">
              <div class="control is-expanded">
                <label class="label">Species</label>
                <div class="select">
                  <select id="specie" name="specie" required>
                    <option disabled selected>Select species</option>
                    <option value="human">Human</option>
                    <option value="zabrak">Zabrak</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="column">
              <div class="control is-expanded">
                <label class="label">Class</label>
                <div class="select">
                  <select id="classChoice" name="classChoice" required>
                    <option disabled selected>Select class</option>
                    <option value="jedi">Jedi</option>
                    <option value="noble">Noble</option>
                    <option value="soldier">Soldier</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="column">
              <div class="control is-expanded">
                <label class="label">Id</label>
                <input class="input" type="text" id="character-id" name="character-id">
              </div>
            </div>
            <div class="column">
              <div class="control is-expanded">
                <label class="label">Character Select</label>
                <div class="select">
                  <select id="characterSelect" name="characterSelect" required>
                    <option disabled selected>Select class</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          <div class="columns">
            <div class="column">
              <div class="control">
                <button type="submit" id="submit-button" class="button is-primary">Add</button>
              </div>
            </div>
            <div class="column">
              <div class="control">
                <button type="submit" id="update-button" class="button is-warning">Update</button>
              </div>
            </div>
            <div class="column">
              <div class="control">
                <button type="submit" id="search-button" class="button is-info">Search</button>
              </div>
            </div>
            <div class="column">
              <div class="control">
                <button type="submit" id="delete-button" class="button is-danger">Delete</button>
              </div>
            </div>
          </div>
        </form>
        <div class="columns">
          <div class="column">
            <div id="output"></div>
          </div>
        </div>
      </div>
    </section>
    <script src="" async defer></script>
    <script>
      const submitBtn = document.getElementById("submit-button");
      const updateBtn = document.getElementById("update-button");
      const searchBtn = document.getElementById("search-button");
      const deleteBtn = document.getElementById("delete-button");

      submitBtn.addEventListener("click", (event) => {
        event.preventDefault();
        characterData = {
          "character-name": document.getElementById("character-name").value,
          "player-name": document.getElementById("player-name").value,
          "age":document.getElementById("age").value,
          "gender":document.getElementById("gender").value,
          "height":document.getElementById("height").value,
          "weight":document.getElementById("weight").value,
          "abilities": {
            "str": document.getElementById("str").value,
            "dex": document.getElementById("dex").value,
            "con": document.getElementById("con").value,
            "int": document.getElementById("int").value,
            "wis": document.getElementById("wis").value,
            "cha": document.getElementById("cha").value
          },
          "specie": document.getElementById("specie").value,
          "class-level": {
            "class": {
              "class-name": document.getElementById("classChoice").value,
              "level": 1
            }
          },
          "defense": {
            "reflex":document.getElementById("refDef").value,
            "fortitude":document.getElementById("fortDef").value,
            "will":document.getElementById("wilDef").value
          },
          "condition":{
            "value":document.getElementById("condition").value,
            "displayName":"Normal"
          },
          "hp":document.getElementById("hitPoints").value,
          "fp":document.getElementById("forcePoints").value,
          "bab":document.getElementById("baseAttackBonus").value,
          "dr":document.getElementById("damageReduction").value,
          "sr":document.getElementById("shieldReduction").value
        }
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "http://localhost:3001/characters", true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify(characterData));
        xhr.onreadystatechange = function() {
          if (xhr.readyState == 4 && xhr.status == 200) {
            let responseData = JSON.parse(this.responseText);
            const serverResponse = document.getElementById("output");
            const characterName = document.getElementById("character-name");
            const playerName = document.getElementById("player-name");
            const age = document.getElementById("age");
            const gender = document.getElementById("gender");
            const height = document.getElementById("height");
            const weight = document.getElementById("weight");
            const strStat = document.getElementById("str");
            const dexStat = document.getElementById("dex");
            const conStat = document.getElementById("con");
            const intStat = document.getElementById("int");
            const wisStat = document.getElementById("wis");
            const chaStat = document.getElementById("cha");
            const specie = document.getElementById("specie");
            const classChoice = document.getElementById("classChoice");
            const refDef = document.getElementById("refDef");
            const fortDef = document.getElementById("fortDef");
            const wilDef = document.getElementById("wilDef");
            const condition = document.getElementById("condition");
            const hitPoints = document.getElementById("hitPoints");
            const forcePoints = document.getElementById("forcePoints");
            const baseAttackBonus = document.getElementById("baseAttackBonus");
            const damageReduction = document.getElementById("damageReduction");
            const shieldReduction = document.getElementById("shieldReduction");
            const charId = document.getElementById("character-id");
            characterName.value = responseData.data['character-name'];
            playerName.value = responseData.data['player-name'];
            age.value = responseData.data['age'];
            gender.value = responseData.data['gender'];
            height.value = responseData.data['height'];
            weight.value = responseData.data['weight'];
            strStat.value = responseData.data.abilities['str'];
            dexStat.value = responseData.data.abilities['dex'];
            conStat.value = responseData.data.abilities['con'];
            intStat.value = responseData.data.abilities['int'];
            wisStat.value = responseData.data.abilities['wis'];
            chaStat.value = responseData.data.abilities['cha'];
            specie.value = responseData.data['specie'];
            classChoice.value = responseData.data['class-level']['class']['class-name'];
            refDef.value = responseData.data['defense']['reflex'];
            fortDef.value = responseData.data['defense']['fortitude'];
            wilDef.value = responseData.data['defense']['will'];
            condition.value = responseData.data['condition']['value'];
            hitPoints.value = responseData.data['hp'];
            forcePoints.value = responseData.data['fp'];
            baseAttackBonus.value = responseData.data['bab'];
            damageReduction.value = responseData.data['dr'];
            shieldReduction.value = responseData.data['sr'];
            charId.value = responseData.id;
            loadUserList();
          }
        }
      });

      updateBtn.addEventListener("click", (event) => {
        event.preventDefault();
        characterData = {
          "_id": document.getElementById("characterSelect").value,
          "character-name": document.getElementById("character-name").value,
          "player-name": document.getElementById("player-name").value,
          "age":document.getElementById("age").value,
          "gender":document.getElementById("gender").value,
          "height":document.getElementById("height").value,
          "weight":document.getElementById("weight").value,
          "abilities": {
            "str": document.getElementById("str").value,
            "dex": document.getElementById("dex").value,
            "con": document.getElementById("con").value,
            "int": document.getElementById("int").value,
            "wis": document.getElementById("wis").value,
            "cha": document.getElementById("cha").value
          },
          "specie": document.getElementById("specie").value,
          "class-level": {
            "class": {
              "class-name": document.getElementById("classChoice").value,
              "level": 1
            }
          },
          "defense": {
            "reflex":document.getElementById("refDef").value,
            "fortitude":document.getElementById("fortDef").value,
            "will":document.getElementById("wilDef").value
          },
          "condition":{
            "value":document.getElementById("condition").value,
            "displayName":"Normal"
          },
          "hp":document.getElementById("hitPoints").value,
          "fp":document.getElementById("forcePoints").value,
          "bab":document.getElementById("baseAttackBonus").value,
          "dr":document.getElementById("damageReduction").value,
          "sr":document.getElementById("shieldReduction").value
        }
        var charId = document.getElementById("character-id").value;
        var xhr = new XMLHttpRequest();
        var searchURL = "http://localhost:3001/characters/" + charId
        xhr.open("PUT", searchURL, true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify(characterData));
        xhr.onreadystatechange = function() {
          if (xhr.readyState == 4 && xhr.status == 200) {
            let responseData = JSON.parse(this.responseText);
            // console.log(responseData);
            const serverResponse = document.getElementById("output");
            const characterName = document.getElementById("character-name");
            const playerName = document.getElementById("player-name");
            const age = document.getElementById("age");
            const gender = document.getElementById("gender");
            const height = document.getElementById("height");
            const weight = document.getElementById("weight");
            const strStat = document.getElementById("str");
            const dexStat = document.getElementById("dex");
            const conStat = document.getElementById("con");
            const intStat = document.getElementById("int");
            const wisStat = document.getElementById("wis");
            const chaStat = document.getElementById("cha");
            const specie = document.getElementById("specie");
            const classChoice = document.getElementById("classChoice");
            const refDef = document.getElementById("refDef");
            const fortDef = document.getElementById("fortDef");
            const wilDef = document.getElementById("wilDef");
            const condition = document.getElementById("condition");
            const hitPoints = document.getElementById("hitPoints");
            const forcePoints = document.getElementById("forcePoints");
            const baseAttackBonus = document.getElementById("baseAttackBonus");
            const damageReduction = document.getElementById("damageReduction");
            const shieldReduction = document.getElementById("shieldReduction");
            const characterSel = document.getElementById("characterSelect");
            const charId = document.getElementById("character-id");
            // console.log(responseData);
            characterName.value = responseData.data['character-name'];
            playerName.value = responseData.data['player-name'];
            age.value = responseData.data['age'];
            gender.value = responseData.data['gender'];
            height.value = responseData.data['height'];
            weight.value = responseData.data['weight'];
            strStat.value = responseData.data.abilities['str'];
            dexStat.value = responseData.data.abilities['dex'];
            conStat.value = responseData.data.abilities['con'];
            intStat.value = responseData.data.abilities['int'];
            wisStat.value = responseData.data.abilities['wis'];
            chaStat.value = responseData.data.abilities['cha'];
            specie.value = responseData.data['specie'];
            classChoice.value = responseData.data['class-level']['class']['class-name'];
            refDef.value = responseData.data['defense']['reflex'];
            fortDef.value = responseData.data['defense']['fortitude'];
            wilDef.value = responseData.data['defense']['will'];
            condition.value = responseData.data['condition']['value'];
            hitPoints.value = responseData.data['hp'];
            forcePoints.value = responseData.data['fp'];
            baseAttackBonus.value = responseData.data['bab'];
            damageReduction.value = responseData.data['dr'];
            shieldReduction.value = responseData.data['sr'];
            characterSel.value = responseData.id;
            charId.value = responseData.id;
          }
        }
      });

      searchBtn.addEventListener("click", (event) => {
        event.preventDefault();
        var charId = document.getElementById("characterSelect").value;
        // console.log(charId);
        var xhr = new XMLHttpRequest();
        var searchURL = "http://localhost:3001/characters/" + charId
        xhr.open("GET", searchURL, true);
        xhr.send();
        xhr.onreadystatechange = function() {
          if (xhr.readyState == 4 && xhr.status == 200) {
            console.log(this.responseText);
            let responseData = JSON.parse(this.responseText);
            // const serverResponse = document.getElementById("output");
            const characterName = document.getElementById("character-name");
            const playerName = document.getElementById("player-name");
            const age = document.getElementById("age");
            const gender = document.getElementById("gender");
            const height = document.getElementById("height");
            const weight = document.getElementById("weight");
            const strStat = document.getElementById("str");
            const dexStat = document.getElementById("dex");
            const conStat = document.getElementById("con");
            const intStat = document.getElementById("int");
            const wisStat = document.getElementById("wis");
            const chaStat = document.getElementById("cha");
            const specie = document.getElementById("specie");
            const classChoice = document.getElementById("classChoice");
            const refDef = document.getElementById("refDef");
            const fortDef = document.getElementById("fortDef");
            const wilDef = document.getElementById("wilDef");
            const condition = document.getElementById("condition");
            const hitPoints = document.getElementById("hitPoints");
            const forcePoints = document.getElementById("forcePoints");
            const baseAttackBonus = document.getElementById("baseAttackBonus");
            const damageReduction = document.getElementById("damageReduction");
            const shieldReduction = document.getElementById("shieldReduction");
            const characterSel = document.getElementById("characterSelect");
            const characterInput = document.getElementById("character-id");
            // console.log(responseData[0]);
            characterName.value = responseData[0]['character-name'];
            playerName.value = responseData[0]['player-name'];
            age.value = responseData[0]['age'];
            gender.value = responseData[0]['gender'];
            height.value = responseData[0]['height'];
            weight.value = responseData[0]['weight'];
            strStat.value = responseData[0].abilities['str'];
            dexStat.value = responseData[0].abilities['dex'];
            conStat.value = responseData[0].abilities['con'];
            intStat.value = responseData[0].abilities['int'];
            wisStat.value = responseData[0].abilities['wis'];
            chaStat.value = responseData[0].abilities['cha'];
            specie.value = responseData[0]['specie'];
            classChoice.value = responseData[0]['class-level']['class']['class-name'];
            refDef.value = responseData[0].defense['reflex'];
            fortDef.value = responseData[0].defense['fortitude'];
            wilDef.value = responseData[0].defense['will'];
            condition.value = responseData[0]['condition']['value'];
            hitPoints.value = responseData[0]['hp'];
            forcePoints.value = responseData[0]['fp'];
            baseAttackBonus.value = responseData[0]['bab'];
            damageReduction.value = responseData[0]['dr'];
            shieldReduction.value = responseData[0]['sr'];
            characterSel.value = responseData[0]['_id'];
            characterInput.value = responseData[0]['_id'];
            // serverResponse.innerHTML = responseData.id;
          }
        }
      });

      deleteBtn.addEventListener("click", (event) => {
        event.preventDefault();
        var charId = document.getElementById("characterSelect").value;
        var xhr = new XMLHttpRequest();
        var deleteURL = "http://localhost:3001/characters/" + charId
        xhr.open("DELETE", deleteURL, true);
        xhr.send();
        xhr.onreadystatechange = function() {
          const characterName = document.getElementById("character-name");
          const strStat = document.getElementById("str");
          const dexStat = document.getElementById("dex");
          const conStat = document.getElementById("con");
          const intStat = document.getElementById("int");
          const wisStat = document.getElementById("wis");
          const chaStat = document.getElementById("cha");
          const specie = document.getElementById("specie");
          const classChoice = document.getElementById("classChoice");
          const characterSel = document.getElementById("characterSelect");
          const characterInput = document.getElementById("character-id");
          characterName.value = "";
          characterSel.value = "";
          characterInput.value = "";
          strStat.value = "";
          dexStat.value = "";
          conStat.value = "";
          intStat.value = "";
          wisStat.value = "";
          chaStat.value = "";
          specie.value = "";
          classChoice.value = "";
          loadUserList();
        }
      });

      function loadUserList() {
        var xhr = new XMLHttpRequest();
        var searchURL = "http://localhost:3001/characters/"
        xhr.open("GET", searchURL, true);
        xhr.send();
        xhr.onreadystatechange = function() {
          // console.log(this.responseText);
        }
        xhr.onreadystatechange = function() {
          if (xhr.readyState == 4 && xhr.status == 200) {
            var data = JSON.parse(this.responseText);
            var dropdownList = "<option disabled selected>Select character</option>\r\n";
            for (var i = 0; i < data.length; i++) {
              dropdownList += '<option value="' + data[i]._id + '">' + data[i]['character-name'] + '</option>\r\n';
              // console.log(data[i]);
            }
            let attachDropdown = document.getElementById("characterSelect");
            attachDropdown.innerHTML = dropdownList;
            // console.log(dropdownList);
          }
        }
      };

      loadUserList();

    </script>
  </body>
</html>